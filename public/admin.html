<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Sample Size Calculator</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Auth Gate Script - Admin requires admin role -->
    <script type="module">
        import { onAuthChange, checkApproval, isAdmin } from './js/authService.js';

        onAuthChange(async (user) => {
            if (!user) {
                window.location.href = 'login.html?redirect=admin.html';
                return;
            }

            const status = await checkApproval();
            const adminCheck = await isAdmin();

            if (!status.approved || !adminCheck) {
                alert('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p Admin Panel. Ch·ªâ admin ƒë∆∞·ª£c ph√©p.');
                window.location.href = 'index.html';
                return;
            }

            document.body.classList.add('authenticated');
        });
    </script>

    <style>
        body:not(.authenticated) .app-container {
            display: none;
        }

        body:not(.authenticated)::after {
            content: 'ƒêang ki·ªÉm tra quy·ªÅn admin...';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            color: #6b7280;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- HEADER -->
        <header class="app-header">
            <div class="header-left">
                <a href="index.html" class="back-link">‚Üê Quay l·∫°i Calculator</a>
            </div>
            <h1>‚öôÔ∏è Admin Panel</h1>
            <div class="header-right">
                <div id="authStatus" class="auth-status">
                    <span id="userEmail">Ch∆∞a ƒëƒÉng nh·∫≠p</span>
                    <button id="loginBtn" class="auth-btn">üîê ƒêƒÉng nh·∫≠p</button>
                    <button id="logoutBtn" class="auth-btn hidden">üö™ ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
        </header>

        <!-- LOGIN REQUIRED MESSAGE -->
        <div class="login-required" id="loginRequired">
            <div class="login-card">
                <h2>üîê Y√™u c·∫ßu ƒêƒÉng nh·∫≠p</h2>
                <p>B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n Admin ƒë·ªÉ truy c·∫≠p trang n√†y.</p>
                <button id="googleLoginBtn" class="google-login-btn">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                    ƒêƒÉng nh·∫≠p v·ªõi Google
                </button>
            </div>
        </div>

        <!-- ADMIN CONTENT -->
        <main class="admin-content hidden" id="adminContent">
            <!-- TABS -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="cases">üìã Cases</button>
                <button class="tab-btn" data-tab="locations">üìç Locations</button>
                <button class="tab-btn" data-tab="audiences">üéØ Target Audience</button>
                <button class="tab-btn" data-tab="templates">üìÑ Templates</button>
                <button class="tab-btn" data-tab="vendors">üè¢ Vendors</button>
                <button class="tab-btn" data-tab="quotaSkew">üìä Quota Skew</button>
                <button class="tab-btn" data-tab="timing">üìÖ Timing</button>
                <button class="tab-btn" data-tab="history">üìú History</button>
                <button class="tab-btn" data-tab="users">üë• Users</button>
            </div>

            <!-- CASES TAB -->
            <div class="tab-content active" id="casesTab">
                <div class="tab-header">
                    <h2>Qu·∫£n l√Ω Cases (Ph√¢n lo·∫°i ƒë·ªô kh√≥)</h2>
                    <button class="add-btn" id="addCaseBtn">+ Th√™m Case</button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="casesTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>T√™n</th>
                                <th>ƒê·ªô kh√≥</th>
                                <th>IR</th>
                                <th>Sample</th>
                                <th>LOI</th>
                                <th>Quota</th>
                                <th>Target</th>
                                <th>Samples/Day</th>
                                <th>FW Days</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="casesTableBody">
                            <tr>
                                <td colspan="11">ƒêang t·∫£i...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="seed-section">
                    <button class="seed-btn" id="seedCasesBtn">üå± T·∫°o 18 Cases m·∫∑c ƒë·ªãnh</button>
                </div>
            </div>

            <!-- LOCATIONS TAB -->
            <div class="tab-content" id="locationsTab">
                <div class="tab-header">
                    <h2>Qu·∫£n l√Ω Locations (IR Defaults)</h2>
                    <button class="add-btn" id="addLocationBtn">+ Th√™m Location</button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="locationsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√™n</th>
                                <th>Tier</th>
                                <th>IR Default</th>
                                <th>IR Range</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="locationsTableBody">
                            <tr>
                                <td colspan="7">ƒêang t·∫£i...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="seed-section">
                    <button class="seed-btn" id="seedLocationsBtn">üå± T·∫°o Locations m·∫∑c ƒë·ªãnh</button>
                </div>
            </div>

            <!-- TEMPLATES TAB -->
            <div class="tab-content" id="templatesTab">
                <div class="tab-header">
                    <h2>Qu·∫£n l√Ω Templates (M·∫´u d·ª± √°n)</h2>
                    <button class="add-btn" id="addTemplateBtn">+ Th√™m Template</button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="templatesTable">
                        <thead>
                            <tr>
                                <th>Icon</th>
                                <th>T√™n</th>
                                <th>Sample</th>
                                <th>IR</th>
                                <th>LOI</th>
                                <th>Quota</th>
                                <th>Target</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="templatesTableBody">
                            <tr>
                                <td colspan="8">ƒêang t·∫£i...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="seed-section">
                    <button class="seed-btn" id="seedTemplatesBtn">üå± T·∫°o Templates m·∫∑c ƒë·ªãnh</button>
                </div>
            </div>

            <!-- VENDORS TAB -->
            <div class="tab-content" id="vendorsTab">
                <div class="tab-header">
                    <h2>üè¢ Qu·∫£n l√Ω Panel Vendors</h2>
                    <button class="add-btn" id="addVendorBtn">+ Th√™m Vendor</button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="vendorsTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>T√™n</th>
                                <th>Lo·∫°i</th>
                                <th>Response Factor</th>
                                <th>QC Reject Default</th>
                                <th>M√¥ t·∫£</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="vendorsTableBody">
                            <tr>
                                <td colspan="7">ƒêang t·∫£i...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="seed-section">
                    <button class="seed-btn" id="seedVendorsBtn">üå± T·∫°o 6 Vendors m·∫∑c ƒë·ªãnh</button>
                </div>
            </div>

            <!-- TARGET AUDIENCE TAB -->
            <div class="tab-content" id="audiencesTab">
                <div class="tab-header">
                    <h2>üéØ Qu·∫£n l√Ω Target Audience</h2>
                    <button class="add-btn" id="addAudienceBtn">+ Th√™m Audience</button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="audiencesTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>T√™n</th>
                                <th>IR Factor</th>
                                <th>Difficulty</th>
                                <th>M√¥ t·∫£</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="audiencesTableBody">
                            <tr>
                                <td colspan="6">ƒêang t·∫£i...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="seed-section">
                    <button class="seed-btn" id="seedAudiencesBtn">üå± T·∫°o 6 Audiences m·∫∑c ƒë·ªãnh</button>
                </div>
            </div>

            <!-- QUOTA SKEW TAB -->
            <div class="tab-content" id="quotaSkewTab">
                <div class="tab-header">
                    <h2>üìä C·∫•u h√¨nh Quota Skew</h2>
                </div>
                <div class="config-cards">
                    <div class="config-card">
                        <h3>‚öñÔ∏è Balanced</h3>
                        <p>Ph√¢n b·ªï ƒë·ªÅu (50/50), Age tr·∫£i ƒë·ªÅu</p>
                        <div class="config-input">
                            <label>Multiplier:</label>
                            <input type="number" id="skewBalanced" value="1.0" step="0.05" min="0.5" max="2">
                        </div>
                    </div>
                    <div class="config-card">
                        <h3>üìä Skew nh·∫π</h3>
                        <p>70/30 ho·∫∑c ch√™nh l·ªách nh·∫π</p>
                        <div class="config-input">
                            <label>Multiplier:</label>
                            <input type="number" id="skewLight" value="1.15" step="0.05" min="0.5" max="2">
                        </div>
                    </div>
                    <div class="config-card">
                        <h3>üéØ Skew n·∫∑ng</h3>
                        <p>Target r·∫•t h·∫πp, kh√≥ fill</p>
                        <div class="config-input">
                            <label>Multiplier:</label>
                            <input type="number" id="skewHeavy" value="1.4" step="0.05" min="0.5" max="2">
                        </div>
                    </div>
                </div>
                <div class="seed-section">
                    <button class="save-config-btn" id="saveQuotaSkewBtn">üíæ L∆∞u c·∫•u h√¨nh</button>
                </div>
            </div>

            <!-- TIMING TAB -->
            <div class="tab-content" id="timingTab">
                <div class="tab-header">
                    <h2>üìÖ C·∫•u h√¨nh Timing & Holidays</h2>
                </div>

                <div class="config-section">
                    <h3>üóìÔ∏è Day-of-Week Factors</h3>
                    <p>H·ªá s·ªë ·∫£nh h∆∞·ªüng theo ng√†y trong tu·∫ßn (1.0 = b√¨nh th∆∞·ªùng)</p>
                    <div class="day-factors-grid">
                        <div class="day-factor">
                            <label>Th·ª© 2</label>
                            <input type="number" id="dayMon" value="0.85" step="0.05" min="0.5" max="1.5">
                        </div>
                        <div class="day-factor">
                            <label>Th·ª© 3</label>
                            <input type="number" id="dayTue" value="0.85" step="0.05" min="0.5" max="1.5">
                        </div>
                        <div class="day-factor">
                            <label>Th·ª© 4</label>
                            <input type="number" id="dayWed" value="1.0" step="0.05" min="0.5" max="1.5">
                        </div>
                        <div class="day-factor">
                            <label>Th·ª© 5</label>
                            <input type="number" id="dayThu" value="1.0" step="0.05" min="0.5" max="1.5">
                        </div>
                        <div class="day-factor">
                            <label>Th·ª© 6</label>
                            <input type="number" id="dayFri" value="0.95" step="0.05" min="0.5" max="1.5">
                        </div>
                        <div class="day-factor">
                            <label>Th·ª© 7</label>
                            <input type="number" id="daySat" value="1.1" step="0.05" min="0.5" max="1.5">
                        </div>
                        <div class="day-factor">
                            <label>CN</label>
                            <input type="number" id="daySun" value="1.1" step="0.05" min="0.5" max="1.5">
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h3>üéâ Holiday Impact Factors</h3>
                    <p>H·ªá s·ªë ch·∫≠m l·∫°i khi r∆°i v√†o l·ªÖ/t·∫øt (1.0 = kh√¥ng ·∫£nh h∆∞·ªüng)</p>
                    <div class="holiday-factors-grid">
                        <div class="holiday-factor">
                            <label>üßß T·∫øt Nguy√™n ƒê√°n</label>
                            <input type="number" id="holidayTet" value="1.8" step="0.1" min="1" max="3">
                        </div>
                        <div class="holiday-factor">
                            <label>üéñÔ∏è 30/4 - 1/5</label>
                            <input type="number" id="holiday30Apr" value="1.25" step="0.05" min="1" max="2">
                        </div>
                        <div class="holiday-factor">
                            <label>üèõÔ∏è Gi·ªó T·ªï H√πng V∆∞∆°ng</label>
                            <input type="number" id="holidayHungVuong" value="1.1" step="0.05" min="1" max="2">
                        </div>
                        <div class="holiday-factor">
                            <label>üáªüá≥ Qu·ªëc Kh√°nh</label>
                            <input type="number" id="holidayNational" value="1.15" step="0.05" min="1" max="2">
                        </div>
                        <div class="holiday-factor">
                            <label>üéÑ Gi√°ng Sinh</label>
                            <input type="number" id="holidayChristmas" value="1.1" step="0.05" min="1" max="2">
                        </div>
                    </div>
                </div>

                <div class="seed-section">
                    <button class="save-config-btn" id="saveTimingBtn">üíæ L∆∞u c·∫•u h√¨nh Timing</button>
                </div>
            </div>

            <!-- HISTORY TAB -->
            <div class="tab-content" id="historyTab">
                <div class="tab-header">
                    <h2>L·ªãch s·ª≠ T√≠nh to√°n</h2>
                    <button class="danger-btn" id="clearHistoryBtn">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="historyTable">
                        <thead>
                            <tr>
                                <th>Ng√†y</th>
                                <th>D·ª± √°n</th>
                                <th>Sample</th>
                                <th>System Days</th>
                                <th>Expert Days</th>
                                <th>Note</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="7">ƒêang t·∫£i...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- USERS TAB -->
            <div class="tab-content" id="usersTab">
                <div class="tab-header">
                    <h2>üë• Qu·∫£n l√Ω Users (Ph√™ duy·ªát truy c·∫≠p)</h2>
                    <button class="add-btn" id="refreshUsersBtn">üîÑ Refresh</button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>Avatar</th>
                                <th>Email</th>
                                <th>T√™n</th>
                                <th>Role</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Ng√†y y√™u c·∫ßu</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td colspan="7">ƒêang t·∫£i...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL -->
    <div class="modal-overlay hidden" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Th√™m m·ªõi</h3>
                <button class="modal-close" id="modalClose">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic form content -->
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="modalCancel">H·ªßy</button>
                <button class="btn-save" id="modalSave">L∆∞u</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/admin.js"></script>
</body>

</html>